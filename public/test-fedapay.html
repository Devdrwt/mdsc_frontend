<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test FedaPay</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .log {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Test FedaPay Widget</h1>
    
    <div>
        <h2>Cl√©s de test :</h2>
        <p><strong>Public Key:</strong> pk_live_vOih1H4lKIr2wmX14GH4H1k_</p>
        <p><strong>Secret Key:</strong> sk_live_pmdRaielgy-XVLhmM04dm4pO</p>
        <p><strong>Environnement:</strong> Live (Production)</p>
    </div>

    <div>
        <h2>Actions :</h2>
        <button id="test-checkout-btn">Tester avec checkout()</button>
        <button id="test-init-btn">Tester avec init()</button>
        <button id="check-api-btn">V√©rifier l'API</button>
    </div>

    <div>
        <h2>Logs :</h2>
        <div id="logs" class="log"></div>
    </div>

    <!-- Script FedaPay -->
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>

    <script>
        const logs = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        // V√©rifier l'API apr√®s chargement
        function checkAPI() {
            log('üîç V√©rification de l\'API FedaPay...', 'info');
            
            const checks = [
                { name: 'window.FedaPay', value: window.FedaPay },
                { name: 'window.fedapay', value: window.fedapay },
                { name: 'window.FedaPayCheckout', value: window.FedaPayCheckout },
                { name: 'window.FedaPayCheckoutJS', value: window.FedaPayCheckoutJS },
            ];

            let found = false;
            checks.forEach(check => {
                if (check.value) {
                    found = true;
                    log(`‚úÖ ${check.name} existe`, 'success');
                    log(`   Type: ${typeof check.value}`, 'info');
                    log(`   Cl√©s: ${Object.keys(check.value).join(', ')}`, 'info');
                    
                    if (typeof check.value.init === 'function') {
                        log(`   ‚úÖ init() disponible`, 'success');
                    }
                    if (typeof check.value.checkout === 'function') {
                        log(`   ‚úÖ checkout() disponible`, 'success');
                    }
                    if (check.value.CHECKOUT_COMPLETED !== undefined) {
                        log(`   ‚úÖ CHECKOUT_COMPLETED = ${check.value.CHECKOUT_COMPLETED}`, 'success');
                    }
                    if (check.value.DIALOG_DISMISSED !== undefined) {
                        log(`   ‚úÖ DIALOG_DISMISSED = ${check.value.DIALOG_DISMISSED}`, 'success');
                    }
                } else {
                    log(`‚ùå ${check.name} n'existe pas`, 'error');
                }
            });

            if (!found) {
                log('‚ùå Aucune API FedaPay trouv√©e dans window', 'error');
                log('V√©rification de toutes les cl√©s window contenant "feda" ou "pay"...', 'info');
                const relevantKeys = Object.keys(window).filter(k => 
                    k.toLowerCase().includes('feda') || k.toLowerCase().includes('pay')
                );
                if (relevantKeys.length > 0) {
                    log(`Cl√©s trouv√©es: ${relevantKeys.join(', ')}`, 'info');
                } else {
                    log('Aucune cl√© pertinente trouv√©e', 'error');
                }
            }

            return found;
        }

        // Test avec checkout()
        function testCheckout() {
            log('üöÄ Test avec checkout()...', 'info');
            
            const api = window.FedaPay || window.fedapay || window.FedaPayCheckout;
            
            if (!api || typeof api.checkout !== 'function') {
                log('‚ùå checkout() non disponible', 'error');
                return;
            }

            try {
                api.checkout({
                    public_key: 'pk_live_vOih1H4lKIr2wmX14GH4H1k_',
                    transaction: {
                        amount: 1000,
                        description: 'Test de paiement',
                        currency: 'XOF',
                    },
                    customer: {
                        email: 'test@example.com',
                        firstname: 'Test',
                        lastname: 'User',
                    },
                    onComplete: function(reason, transaction) {
                        log(`‚úÖ onComplete appel√©: reason=${reason}`, 'success');
                        log(`Transaction: ${JSON.stringify(transaction, null, 2)}`, 'info');
                    }
                });
                log('‚úÖ checkout() appel√© avec succ√®s', 'success');
            } catch (error) {
                log(`‚ùå Erreur avec checkout(): ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Test avec init()
        function testInit() {
            log('üöÄ Test avec init()...', 'info');
            
            const api = window.FedaPay || window.fedapay || window.FedaPayCheckout;
            
            if (!api || typeof api.init !== 'function') {
                log('‚ùå init() non disponible', 'error');
                return;
            }

            try {
                const widget = api.init({
                    public_key: 'pk_live_vOih1H4lKIr2wmX14GH4H1k_',
                    transaction: {
                        amount: 1000,
                        description: 'Test de paiement',
                        currency: 'XOF',
                    },
                    customer: {
                        email: 'test@example.com',
                        firstname: 'Test',
                        lastname: 'User',
                    },
                    onComplete: function(reason, transaction) {
                        log(`‚úÖ onComplete appel√©: reason=${reason}`, 'success');
                        log(`Transaction: ${JSON.stringify(transaction, null, 2)}`, 'info');
                    }
                });
                
                log(`‚úÖ init() appel√© avec succ√®s`, 'success');
                log(`Widget retourn√©: ${JSON.stringify(widget, null, 2)}`, 'info');
                
                if (widget && typeof widget.open === 'function') {
                    log('‚úÖ widget.open() disponible, ouverture...', 'info');
                    setTimeout(() => {
                        try {
                            widget.open();
                            log('‚úÖ widget.open() appel√©', 'success');
                        } catch (error) {
                            log(`‚ùå Erreur avec widget.open(): ${error.message}`, 'error');
                        }
                    }, 500);
                }
            } catch (error) {
                log(`‚ùå Erreur avec init(): ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
            }
        }

        // Attendre le chargement du script
        window.addEventListener('load', function() {
            log('üìÑ Page charg√©e', 'info');
            
            // V√©rifier imm√©diatement
            setTimeout(() => {
                checkAPI();
            }, 500);
            
            // V√©rifier √† nouveau apr√®s 2 secondes
            setTimeout(() => {
                log('üîÑ V√©rification apr√®s 2 secondes...', 'info');
                checkAPI();
            }, 2000);
        });

        // √âcouter les erreurs de chargement du script
        document.querySelector('script[src*="checkout.js"]').addEventListener('error', function() {
            log('‚ùå Erreur lors du chargement du script checkout.js', 'error');
        });

        // √âcouter le chargement du script
        document.querySelector('script[src*="checkout.js"]').addEventListener('load', function() {
            log('‚úÖ Script checkout.js charg√©', 'success');
            setTimeout(() => {
                checkAPI();
            }, 500);
        });

        // Boutons
        document.getElementById('check-api-btn').addEventListener('click', checkAPI);
        document.getElementById('test-checkout-btn').addEventListener('click', testCheckout);
        document.getElementById('test-init-btn').addEventListener('click', testInit);
    </script>
</body>
</html>

